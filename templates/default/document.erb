<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Requirements <%= title %></title>
  <link rel="stylesheet" type="text/css" media="all" href="http://resources.fngtps.com/2006/doc.css" />
</head>
<body id="doc" class="requirements">
  <h1>Requirements<br><%= title %></h1>

  <% authors.each do |author| %>
  <p class="author"><%=h format_author(author) %></p>
  <% end %>

  <% introduction.each do |paragraph| %>
  <p><%=h paragraph %></p>
  <% end %>

  <% unless stories.empty? %>
  <h2>User stories</h2>
  <% stories.each do |header, stories| %>
  <% unless header.strip == '' %>
  <h3><%=h header %></h3>
  <% end %>
  <table class="review">
  <tr>
    <th></th>
    <th title="id">#</th>
    <th title="Estimate">e</th>
    <th title="Iteration">i</th>
    <th title="Status">s</th>
  </tr>
  <% stories.each do |story| %>
  <tr class="<%= story[:status] %>" id="story<%= story[:id] %>">
    <td class="story"><%=h story[:description] %></td>
    <td class="meta id"><%=h story[:id] %></td>
    <td class="meta estimate"><%=h format_estimate(*story[:estimate]) if story[:estimate] %></td>
    <td class="meta iteration"><%=h story[:iteration] %></td>
    <td class="meta status"><%=h story[:status] %></td>
  </tr>
  <% if story[:notes] %>
  <tr class="<%= story[:status] %>">
    <td class="notes" colspan="5"><%=h story[:notes] %></td>
  </tr>
  <% end %>
  <% if story[:stories] %>
  <% story[:stories].each do |nested| %>
  <tr class="nested <%= nested[:status] %>" id="story<%= nested[:id] %>">
    <td class="story"><%=h nested[:description] %></td>
    <td class="meta id"><%=h nested[:id] %></td>
    <td class="meta estimate"><%=h format_estimate(*nested[:estimate]) if nested[:estimate] %></td>
    <td class="meta iteration"><%=h nested[:iteration] %></td>
    <td class="meta status"><%=h nested[:status] %></td>
  </tr>
  <% if nested[:notes] %>
  <tr class="nested <%= nested[:status] %>">
    <td class="notes" colspan="5"><%=h nested[:notes] %></td>
  </tr>
  <% end %>
  <% end %>
  <% end %>
  <% end %>
  </table>
  <% end %>
  <% end %>

  <% definitions.each do |header, definitions| %>
  <% unless header.strip == '' %>
  <h2><%=h format_header(header) %></h2>
  <% end %>
  <dl>
  <% definitions.each do |definition| %>
  <dt><%=h definition[:title] %></dt>
  <dd><%=h definition[:definition] %></dd>
  <% end %>
  </dl>
  <% end %>
  </body>
</html>