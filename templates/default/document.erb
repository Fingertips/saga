<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Requirements <%= title %></title>
  <style>
    /* Links */

    a
    {
      color: #00c;
      text-decoration: none;
    }
    a:hover,
    a:active
    {
      text-decoration: underline;
    }
    a:visited
    {
      color: #009;
    }

    /* Typography and margins */

    body,
    table
    {
      font: 14px/18px palatino, georgia, serif;
    }
    h1,
    h2 
    {
      margin: 12px 0 6px 0;
      font-size: 18px;
      line-height: 30px;
      letter-spacing: -.5px;
      font-weight: normal;
      color: #222;
    }
    h3
    {
      font-size: 14px;
    }
    p,
    ul,
    ol
    {
      margin: 12px 0;
    }
    p.date,
    p.author
    {
      clear: both;
      margin: 6px 0;
    }
    p.number,
    #doc p.date
    {
      margin: 6px 0 24px 0;
    }
    p.author,
    #doc p.date
    {
      font-style: italic;
    }
    table,
    dl
    {
      margin: 21px 0 24px 0;
    }
    p.greeting
    {
      margin: 24px 0;
    }
    p.signature,
    p.attachments
    {
      margin: 72px 0 24px 0;
    }

    /* Page structure */

    html,
    body
    {
      margin: 0;
      padding: 0;
    }
    body
    {
      padding: 0 10%;
      background: rgb(255,255,255);
      background-image: linear-gradient(rgba(0,0,0,0.07), rgba(0,0,0,0));
      background-position: left top;
      background-repeat: no-repeat;
      background-size: 100% 5%;
    }
    body.requirements
    {
      padding: 0 2em;
    }
    #logo
    {
      float: right;
      width: 123px;
      height: 123px;
      margin: 0 0 0 12px;
      padding: 0;
    }
    #logo img
    {
      display: block;
      width: 123px;
      height: 123px;
    }
    h1
    {
      margin: 0 0 24px 0;
      padding-top: 73px;
    }
    .vcard 
    {
      margin: 12px 0;
      padding: 5px 0 0 0;
      border-top: 1px solid #ccc;
      font-size: 12px;
      text-align: right;
      color: #777
    }

    /* Invoice table */

    table
    {
      border-collapse: collapse;
      empty-cells: show;
    }
    table.invoice th,
    table.invoice td
    {
      padding: 0 18px 0 0;
      vertical-align: top;
      text-align: left;
      line-height: 24px;
    }
    table.invoice .amount
    {
      text-align: right;
      white-space: nowrap;
    }
    table.invoice .note
    {
      padding: 0;
    }
    table.invoice tbody,
    table.invoice tr.total
    {
      border-top: 1px solid #ccc;
    }
    table.invoice tbody.total th
    {
      text-align: right;
      font-weight: normal;
    }
    table.invoice tr.total th,
    table.invoice tr.total td
    {
      font-weight: bold;
    }

    /* Data table */

    table.data 
    {
      font-size: 12px;
    }
    table.data th,
    table.data td
    {
      padding: 2px 6px;
      text-align: left;
      vertical-align: top;
      border: 1px solid #ccc;
    }
    table.data th
    {
      background-color: #eee;
    }
    table.data .separator
    { 
      border-top: 2px solid #000;
    }
    body.requirements table.data .dropped
    {
      color: #999; 
      background-color: #f6f6f8; 
      text-decoration: line-through;
    }
    body.requirements table.data .done
    {
      background-color: #f0f8ff;
    }

    /* Stories table */
    td.id { text-align: right !important; }
    td.id a { color: #000; }
    table.review { border-bottom: 1px solid #ccc; margin-top: -1em;}
    table.review td { padding: .25em 0; vertical-align: top; text-align: left; min-width: 1em; }
    table.review th { padding: .25em 0; vertical-align: top; text-align: right; }
    table.review td.story { width: 100%; border-top: 1px solid #ccc; }
    table.review td.meta { padding-left: 1em; border-top: 1px solid #ccc; text-align: right !important; white-space: nowrap; }
    table.review td.notes { color: #666; padding: 0 0 .25em 0; font-style: italic; }
    table.review .dropped { color: #666; text-decoration: line-through; }
    table.review .done { color: #666; background-color: #f0f8ff; }
    table.review tr.nested td.story { padding-left: 1em; }

    /* Plain lists */

    ul,
    ol
    {
      padding: 0;
    }
    ul
    {
      list-style-type: square;
    }
    li
    {
      margin: 0;
      padding: 0;
    }
    .separated li
    {
      margin: .5em 0;
    }
    li li
    {
      margin-left: 2em;
    }

    /* Definition list */

    dl
    {
      border-bottom: 1px solid #ccc;
    }
    dt,
    dd
    {
      margin: 0;
    }
    dt
    {
      padding: 6px 1em 0 0;
      display: block;
      float: left;
      clear: both;
      font-weight: bold;
    }
    dd
    {
      padding: 6px 0;
      border-top: 1px solid #ccc;
      padding-left: 25%;
      display: block;
    }

    /* Additional elements */

    hr
    {
      margin: 2em 0;
      height: 1px;
      background-color: #ccc;
      border: none;
    }
    div.note
    {
      margin: 2em 0;
      padding: 1px 18px;
      border: 1px solid #ccc;
      background-color: #f6f6f8;
    }

    /* Printing */

    @media print
    {
      .noprint
      {
        display: none;
      }
      body,
      table
      {
        font: 12px/15px palatino, georgia, serif;
      }
      table.invoice th,
      table.invoice td
      {
        line-height: 20px;
      }
      table.data,
      .vcard 
      {
        font-size: 10px;
      }
      a,
      a:visited,
      h1,
      h2,
      .vcard
      {
        color: #000;
      }
      h1
      {
        padding-top: 0;
      }
      body
      {
        padding: 1em 3em;
      }
      body
      {
        background: none;
      }
    }
  </style>
</head>
<body id="doc" class="requirements">
  <h1>Requirements<br><%= title %></h1>

  <% authors.each do |author| %>
  <p class="author"><%= format_author(author) %></p>
  <% end %>

  <% introduction.each do |paragraph| %>
  <p><%=h paragraph %></p>
  <% end %>

  <% unless stories.empty? %>
  <h2>User stories</h2>
  <% stories.each do |header, stories| %>
  <% unless header.strip == '' %>
  <h3><%=h header %></h3>
  <% end %>
  <table class="review">
  <tr>
    <th></th>
    <th title="id">#</th>
    <th title="Estimate">e</th>
    <th title="Iteration">i</th>
    <th title="Status">s</th>
  </tr>
  <% stories.each do |story| %>
  <tr class="<%= story[:status] %>" id="story<%= story[:id] %>">
    <td class="story"><%=h story[:description] %></td>
    <td class="meta id"><%=h story[:id] %></td>
    <td class="meta estimate"><%= format_estimate(*story[:estimate]) if story[:estimate] %></td>
    <td class="meta iteration"><%=h story[:iteration] %></td>
    <td class="meta status"><%=h story[:status] %></td>
  </tr>
  <% if story[:notes] %>
  <tr class="<%= story[:status] %>">
    <td class="notes" colspan="5"><%=h story[:notes] %></td>
  </tr>
  <% end %>
  <% if story[:stories] %>
  <% story[:stories].each do |nested| %>
  <tr class="nested <%= nested[:status] %>" id="story<%= nested[:id] %>">
    <td class="story"><%=h nested[:description] %></td>
    <td class="meta id"><%=h nested[:id] %></td>
    <td class="meta estimate"><%= format_estimate(*nested[:estimate]) if nested[:estimate] %></td>
    <td class="meta iteration"><%=h nested[:iteration] %></td>
    <td class="meta status"><%=h nested[:status] %></td>
  </tr>
  <% if nested[:notes] %>
  <tr class="nested <%= nested[:status] %>">
    <td class="notes" colspan="5"><%=h nested[:notes] %></td>
  </tr>
  <% end %>
  <% end %>
  <% end %>
  <% end %>
  </table>
  <% end %>
  <% end %>

  <% definitions.each do |header, definitions| %>
  <% unless header.strip == '' %>
  <h2><%= format_header(header) %></h2>
  <% end %>
  <dl>
  <% definitions.each do |definition| %>
  <dt><%=h definition[:title] %></dt>
  <dd><%=h definition[:definition] %></dd>
  <% end %>
  </dl>
  <% end %>
  </body>
</html>